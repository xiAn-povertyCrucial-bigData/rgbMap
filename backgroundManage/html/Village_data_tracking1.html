<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="renderer" content="webkit">
    <title>后台贫困村数据足迹</title>
    <link rel="stylesheet" href="../css/pintuer.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../css/pagination.css">
    <!--<link rel="stylesheet" href="../css/inputStyle.css">-->
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/commer.js"></script>
    <script src="../js/jquery.js"></script>
    <script src="../js/pintuer.js"></script>
    <script src="../js/jquery.cookie.js"></script>
    <script src="../js/inputJavaScript.js"></script>
    <script src="../js/jquery.pagination.js"></script>
    <style>
	.panel>.form-01>#formSubmit00,.panel>#formSubmit00>tbody{
	    width: 100%;
	    font-size: 14px;
	    margin-top: 10px;
	}
	.form-01 table tr th{
	    height: 40px;
	    line-height: 40px;
	    border:solid 1px #ddd;
	   background: #fcfcfc;
	}

	.form-01 #formSubmit00 tr td{
	    height: 34px;
	    line-height: 34px;
	    border:solid 1px #ddd;
	    text-align: center;
	}
	.form-01 #formSubmit00 tr td:nth-child(9),.form-01 #formSubmit00 tr td:nth-child(10){
		color: #00c120;
	}
	.form-01 #formSubmit00 tr td:nth-child(11),.form-01 #formSubmit00 tr td:nth-child(12){
		color: #ff6c00;
	}
	#import{cursor: pointer;}
	.spinner {
            margin: 5% auto;
            width: 80px;
            height: 80px;
            position: relative;
        }
        .container1 > div, .container2 > div, .container3 > div {
            width: 14px;
            height: 14px;
            background-color: #858585;
            border-radius: 100%;
            position: absolute;
            -webkit-animation: bouncedelay 1.2s infinite ease-in-out;
            animation: bouncedelay 1.2s infinite ease-in-out;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
        }
        .spinner .spinner-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .container2 {
            -webkit-transform: rotateZ(45deg);
            transform: rotateZ(45deg);
        }
        .container3 {
            -webkit-transform: rotateZ(90deg);
            transform: rotateZ(90deg);
        }
        .circle1 { top: 0; left: 0; }
        .circle2 { top: 0; right: 0; }
        .circle3 { right: 0; bottom: 0; }
        .circle4 { left: 0; bottom: 0; }
        .container2 .circle1 {
            -webkit-animation-delay: -1.1s;
            animation-delay: -1.1s;
        }
        .container3 .circle1 {
            -webkit-animation-delay: -1.0s;
            animation-delay: -1.0s;
        }
        .container1 .circle2 {
            -webkit-animation-delay: -0.9s;
            animation-delay: -0.9s;
        }
        .container2 .circle2 {
            -webkit-animation-delay: -0.8s;
            animation-delay: -0.8s;
        }
        .container3 .circle2 {
            -webkit-animation-delay: -0.7s;
            animation-delay: -0.7s;
        }
        .container1 .circle3 {
            -webkit-animation-delay: -0.6s;
            animation-delay: -0.6s;
        }
        .container2 .circle3 {
            -webkit-animation-delay: -0.5s;
            animation-delay: -0.5s;
        }
        .container3 .circle3 {
            -webkit-animation-delay: -0.4s;
            animation-delay: -0.4s;
        }
        .container1 .circle4 {
            -webkit-animation-delay: -0.3s;
            animation-delay: -0.3s;
        }
        .container2 .circle4 {
            -webkit-animation-delay: -0.2s;
            animation-delay: -0.2s;
        }
        .container3 .circle4 {
            -webkit-animation-delay: -0.1s;
            animation-delay: -0.1s;
        }
        @-webkit-keyframes bouncedelay {
            0%, 80%, 100% { -webkit-transform: scale(0.0) }
            40% { -webkit-transform: scale(1.0) }
        }
        @keyframes bouncedelay {
            0%, 80%, 100% {
                transform: scale(0.0);
                -webkit-transform: scale(0.0);
            } 40% {
                  transform: scale(1.0);
                  -webkit-transform: scale(1.0);
              }
        }
    </style>
</head>
<body>
<div class="panel admin-panel">
  <div class="panel-head"><strong><span class="icon-pencil-square-o"></span>贫困村数据足迹</strong>
      <a href="javascript:history.back(-1)" class="data_tracking button border-main">返回</a>
            <span id="import" class="data_tracking button border-main">导出</span>
  </div>
  <div class="form-01">
      <div class="search">
          <label for="">行政区划</label>
          <!--<input type="text" value="西安市" disabled>-->
          <select name="" id="p_shi">
          </select>
          <select name="" id="county">
          	<option value="">县（区）</option>
          </select>
          <select name="" id="township">
          </select>
          <select name="" id="village">
          </select>

        <div>
        	<label for="">贫困村属性</label>
              <select name="" id="shuxing">
               		<option value="">请选择</option>
                  	<option value="01">贫困村</option>
                    <option value="02">非贫困村</option>
             </select>
        	<lable style='width:105px;margin-right: 12px;display: inline-block;'>村办公电话</lable><input type="text" id="cunnumber" />
        	<lable style='width:105px;margin-right: 12px;display: inline-block;'>操作人</lable><input type="text" id="bfname" />

        </div>
        <div style="overflow: hidden;">
      		  <label for="">修改类别</label>
              <select name="" id="updateType">
                  <option value="">请选择</option>
                  	  <option value="15">基本信息</option>
                      <option value="16">土地信息</option>
                      <option value="17">人口信息</option>
                      <option value="18">收入信息</option>
                      <option value="19">社会保障信息(卫计)</option>
                      <option value="20">社会保障信息(人社)</option>
                      <option value="21">村级道路通畅</option>
                      <option value="22">安全饮水</option>
                      <option value="23">农村电力保障</option>
                      <option value="24">危房改造</option>
                      <option value="25">特色产业增收</option>
                      <option value="26">乡村旅游</option>
                      <option value="27">卫生和计划教育</option>
                      <option value="28">文化建设</option>
                      <option value="29">贫困村信息化</option>
              </select>
              <label for="">修改指标</label>
              <select name="" id="typeShip">
              	<option value="">--请选择--</option>
              </select>
              <lable style='width:105px;margin-right: 6px;display: inline-block;'>修改时间</lable>
              <input type="date" id="start" style="width: 130px;"/> -- <input type="date" id="end" style="width: 130px;"/>
        </div>
        <input type="button" class="btn_blue" style="float: right;" name="" value="查询">
      </div>

      <div class="spinner" style="display: none;z-index: 999">
	          <div class="spinner-container container1">
	              <div class="circle1"></div>
	              <div class="circle2"></div>
	              <div class="circle3"></div>
	              <div class="circle4"></div>
	          </div>
	          <div class="spinner-container container2">
	              <div class="circle1"></div>
	              <div class="circle2"></div>
	              <div class="circle3"></div>
	              <div class="circle4"></div>
	          </div>
	          <div class="spinner-container container3">
	              <div class="circle1"></div>
	              <div class="circle2"></div>
	              <div class="circle3"></div>
	              <div class="circle4"></div>
	          </div>
	    </div>
      <table id="formSubmit00" class="form-x">
          <tr>
              <th>序号</th>
              <th>区县</th>
              <th>镇街</th>
              <th>行政村</th>
              <th>村属性</th>
              <th>村办公电话</th>
              <th>修改人姓名</th>
              <th>修改人电话</th>
              <th>修改类别</th>
              <th>修改字段</th>
              <th>修改前值</th>
              <th>修改后值</th>
              <th>修改时间</th>
          </tr>

      </table>
      <div class="pages">
          <div class="paging">
              <div id="Pagination"></div>
              <div class="searchPage">
                  <span class="page-sum">共<strong class="allPage"></strong>页</span>
                 <span id="total"></span>
          </div>
      </div>
  </div>
</div>
</div>
<script>
var city = $("#county");
var area = $("#township");
var town =$("#village");
var start=$('#start');
var end=$('#end');
var bianhao;
var totle;
var str = `<option value="">县（区）</option>`;
city.html(str);
var str1 = `<option value="">乡（镇）</option>`;
area.html(str1);
var str2 = `<option value="">村</option>`;
town.html(str2);
let token=$.cookie("token");
let tokenCon=$.cookie("loginMessage");
let aa=JSON.parse(tokenCon);
//行政区划渲染
//加载西安市
init_Shi();
    function init_Shi(){
        var p_shi=$("#p_shi");
        $.ajax({
            url: url + "district/city",
            data:{},
            beforeSend:function(request){
                request.setRequestHeader("Authorization",token);
                request.setRequestHeader("X-Requested-With","XMLHttpRequest");
            },
            method: "get",
            dataType: "json",
            json: "callback",
            jsonpCallback: 'jsonpCallback',
            success: function(data){
                if (data.code == 2000){
                    showShiInfo(p_shi,data);
                    init_County()
                }
            }
        })
    }
    function showShiInfo(obj,data){
        obj.empty();
        var str = `<option value="">全部</option>`;
        var string = "";
        let arr=[];
        for(let i = 0; i < data.data.length; i++){
            str += `
         <option value="${data.data[i].AAR001}">${data.data[i].AAR009}</option>
     `;
            let obj={"number":data.data[i].AAR001,"name":data.data[i].AAR009};
            arr.push(obj);
        }
        obj.html(str);
        let tokenCon=$.cookie("loginMessage");
        let aa=JSON.parse(tokenCon);
        if(aa.aar008==619900000000){
        	$("#p_shi").empty().append("<option value='619900000000'>西咸新区</option>").attr("disabled","disabled");
        }
    }
	$("#p_shi").change(function(){
	    var opt=$("#p_shi");
	    var city = $("#county");
	         $.ajax({
	            url: url + "district/county",
	            data:{"aar001":opt.val()},
	            beforeSend:function(request){
			          request.setRequestHeader("Authorization",token);
			          request.setRequestHeader("X-Requested-With","XMLHttpRequest");
		        },
	            method: "get",
	            dataType: "json",
	            json: "callback",
	            jsonpCallback: 'jsonpCallback',
	            success: function(data){
	                if (data.code == 2000){
	                     init_County(city);
	                }
	            }
	    })
	});
function init_County(city){
	var opt=$("#p_shi");
	var city = $("#county");
    $.ajax({
	    url: url + "district/county",
	    data:{"aar001":opt.val()},
	    beforeSend:function(request){
              request.setRequestHeader("Authorization",token);
              request.setRequestHeader("X-Requested-With","XMLHttpRequest");
        },
	    method: "get",
	    dataType: "json",
	    json: "callback",
	    jsonpCallback: 'jsonpCallback',
	    success: function(data){
	        if (data.code == 2000){
	            showCountyInfo( city,data);
	        }
	    }
    })
}
function showCountyInfo(obj,data){
     obj.empty();
     var str = `<option value="">县（区）</option>`;
     var string = "";
     let arr=[];
     for(let i = 0; i < data.data.length; i++){
         str += `
         <option value="${data.data[i].AAR001}">${data.data[i].AAR009}</option>
     `;
         let obj={"number":data.data[i].AAR001,"name":data.data[i].AAR009};
         arr.push(obj);
     }
     obj.html(str);
    let tokenCon=$.cookie("loginMessage");
    let aa=JSON.parse(tokenCon);
    for(let i=0;i<arr.length;i++){
        //console.log(arr[i].number+"---"+aa.aaa113);
        if(arr[i].number==aa.aar008 ||arr[i].number==aa.aaa113){
            $("#county").empty().append("<option value='"+arr[i].number+"'>"+arr[i].name+"</option>").attr("disabled","disabled");
            $("#p_shi").attr("disabled","disabled");
            var opt=$("#county");
            var opt1 = $("#township");
            $.ajax({
                url: url + "district/town",
                data:{"county":opt.val()},
                beforeSend:function(request){
                    request.setRequestHeader("Authorization",token);
                    request.setRequestHeader("X-Requested-With","XMLHttpRequest");
                },
                method: "get",
                dataType: "json",
                json: "callback",
                jsonpCallback: 'jsonpCallback',
                success: function(data){
                    if (data.code == 2000){
                        showTownInfo(opt1,data);
                        page.html(data.data.total);
                    }
                }
            })
        }
    }
}

$("#county").change(function(){
    var opt=$("#county");
    var opt1 = $("#township");
         $.ajax({
            url: url + "district/town",
            data:{"county":opt.val()},
            beforeSend:function(request){
                  request.setRequestHeader("Authorization",token);
                  request.setRequestHeader("X-Requested-With","XMLHttpRequest");
            },
            method: "get",
            dataType: "json",
            json: "callback",
            jsonpCallback: 'jsonpCallback',
            success: function(data){
                if (data.code == 2000){
                    showTownInfo(opt1,data);
                     page.html(data.data.total);
                }
            }
    })
});

function showTownInfo(obj,data){
     obj.empty();
     let arr=[];
     var str = `<option value="">乡（镇）</option>`;
     for(let i = 0; i < data.data.length; i++){
         str += `
         <option value="${data.data[i].AAR001}">${data.data[i].AAR009}</option>
     `;
      obj.html(str);
         let obj2={"number":data.data[i].AAR001,"name":data.data[i].AAR009};
         arr.push(obj2);
     }
    let tokenCon=$.cookie("loginMessage");
    let aa=JSON.parse(tokenCon);
    if(aa.aar008.substring(6)!="000000"){
        for(let i=0;i<arr.length;i++){
            if(arr[i].number==aa.aar008){
                $("#township").empty().append("<option value='"+aa.aar008+"'>"+aa.userCode+"</option>").attr("disabled","disabled");
                var opt=$("#township");
                var opt1 = $("#village");
                $.ajax({
                    url: url + "district/village",
                    data:{"town":opt.val()},
                    beforeSend:function(request){
                        request.setRequestHeader("Authorization",token);
                        request.setRequestHeader("X-Requested-With","XMLHttpRequest");
                    },
                    method: "get",
                    dataType: "json",
                    json: "callback",
                    jsonpCallback: 'jsonpCallback',
                    success: function(data){
                        if (data.code == 2000){
                            var town = $("#township").val();
                            var vill = $("#village");
                            $.ajax({
                                url: url + "district/village",
                                data:{"town": town},
                                method: "get",
                                dataType: "json",
                                beforeSend:function(request){
                                    request.setRequestHeader("Authorization",token);
                                    request.setRequestHeader("X-Requested-With","XMLHttpRequest");
                                },
                                success: function(data){
                                    if (data.code == 2000){
                                        showVillageInfo(vill,data);
                                    }
                                }
                            })
                            showVillageInfo(opt1,data);
                            page.html(data.data.total);
                        }
                    }
                })
            }
        }
    }
}

$("#township").change(function(){
    var town = $("#township").val();
    var vill = $("#village");
         $.ajax({
            url: url + "district/village",
            data:{"town": town},
            method: "get",
            dataType: "json",
            beforeSend:function(request){
                  request.setRequestHeader("Authorization",token);
                  request.setRequestHeader("X-Requested-With","XMLHttpRequest");
            },
            success: function(data){
                if (data.code == 2000){
                    showVillageInfo(vill,data);
                }
            }
    })
});
function showVillageInfo(obj,data){
       obj.empty();
     var str = `<option value="">村</option>`;
     for(let i = 0; i < data.data.length; i++){
         str += `
         <option value="${data.data[i].AAR001}">${data.data[i].AAR009}</option>
     `;
      obj.html(str);
     }
}
let updateType=$("#updateType");
let typeShip=$("#typeShip");
updateType.change(function(){
    tiantype();
})
/*修改类别函数*/
function tiantype(){
    var type=$("#updateType").val();
    $.ajax({
        url: url+"info/poverty/field",
        beforeSend:function(request){
            request.setRequestHeader("Authorization",token);
            request.setRequestHeader("X-Requested-With","XMLHttpRequest");
        },
        data:{"type":type},
        async:false,
        method:"post",
        type:"json",
        success:function(data){
            if(data.code === 2000){
                showType(typeShip,data.data);
            }
        }
    })
}
function showType(obj,data){
    obj.empty();
    let str=`<option value="">--请选择--</option>`;
    for(let i in data){
        str+=`
         <option value="${data[i]}">${i}</option>
        `;
    }
    obj.html(function(i,value){
        return value+str;
    })
}
    function ShowLoading() {
	    $(".spinner").show();
	}
	function HideLoading() {
	    $(".spinner").hide();
	}

    var formSubmit00 = $("#formSubmit00");
    let indexs=1;
    var page = $(".allPage");
    $(document).ready(function(){
        $("#Pagination").pagination("15");
    })

    let zhanghao=aa.aar008;
	console.log(zhanghao);
	var data_={"page_size":12,"page_index":1,'aar040':201808,'disctId':zhanghao};
    $.ajax({
        url:url+"data/track/bg/vill",
        //data:{"page_size":12,"page_index":1,'disctId':zhanghao,'year':201808},
        data:JSON.stringify(data_),
        method:"post",
        beforeSend:function(request){
            request.setRequestHeader("Authorization",token);
            request.setRequestHeader("X-Requested-With","XMLHttpRequest");
            ShowLoading();
        },
        dataType:"json",
        contentType:"application/json",
        success:function(data){
        	if($("#village").val()==''&$("#township").val()==''&$("#county").val()==''){
				bianhao=$("#p_shi").val()
			}
			if($("#village").val()==''&$("#township").val()==''&$("#county").val()!=''){
				bianhao=$("#county").val()
			}
			if($("#village").val()==''&$("#township").val()!=''){
				bianhao=$("#township").val()
			}
			if($("#village").val()!=''){
				bianhao=$("#village").val()
			}
            if(data.code===2000){
               showInfo(0,formSubmit00,data.data);
               page.html(Math.ceil(data.data.total/12));
               $("#total").html("总数："+data.data.total);
               totle=data.data.total;
               showPage($(".searchPage"),data.data.total);
            }else if(data.code==1005){
              alert(data.message)
            }else if(data.code==1009){
              alert(data.message)
            }else if(data.code==4000){
              alert(data.message)
            }
        },
        complete:function(){
		     HideLoading();
		}
    })

function showInfo(index,obj,data){
    obj.empty();
   var  str=`
       <tr>
              <th>序号</th>
              <th>区县</th>
              <th>镇街</th>
              <th>行政村</th>
              <th>村属性</th>
              <th>村办公电话</th>
              <th>操作人</th>

              <th>修改类别</th>
              <th>修改字段</th>
              <th>修改前值</th>
              <th>修改后值</th>
              <th>修改时间</th>
          </tr>
    `;
    for(let i = 0; i < data.list.length; i++){
      str+=` <tr>
              <td>${index*12+i+1}</td>
              <td>${data.list[i].AAR009_X}</td>
              <td>${data.list[i].AAR009_Z}</td>
              <td>${data.list[i].AAR009_C}</td>
              <td>${data.list[i].AAD004}</td>
              <td>${data.list[i].VILL_PHONE}</td>

              <td>${data.list[i].USER_CODE}</td>
              <td>${data.list[i].MODIFY_TYPE}</td>
              <td>${data.list[i].INFO_NAME}</td>
              <td>${data.list[i].UPDATE_DEFORE}</td>
              <td>${data.list[i].UPDATE_AFTER}</td>
              <td>${data.list[i].UPDATE_TIMES}</td>
          </tr>`;
    }
    obj.html(str);

}

    function page_init(index) {
    	if($("#village").val()==''&$("#township").val()==''&$("#county").val()==''){
			bianhao=$("#p_shi").val()
		}
		if($("#village").val()==''&$("#township").val()==''&$("#county").val()!=''){
			bianhao=$("#county").val()
		}
		if($("#village").val()==''&$("#township").val()!=''){
			bianhao=$("#township").val()
		}
		if($("#village").val()!=''){
			bianhao=$("#village").val()
		}
    	var start2 = start.val().replace(/-/g,"");//开始结束时间的截取数字
        var end2 = end.val().replace(/-/g,"");
        if(start2 >= end2){
           end2="";
           end.val("");
        }
		indexs=index+1;
		var data_={"page_index": index+1,"page_size": 12,'aar040':201808,'disctId':bianhao,'villNumber':$('#cunnumber').val(),
            'helperName':$('#bfname').val(),'type':$('#updateType').val(),
            'field':$('#typeShip').val(),'startTime':start2,'endTime':end2,'attribute':$('#shuxing').val()}
        $.ajax({
                url:url + "data/track/bg/vill",
                type:"post",
                data:JSON.stringify(data_),
                beforeSend:function(request){
                    request.setRequestHeader("Authorization",token);
                    request.setRequestHeader("X-Requested-With","XMLHttpRequest");
                    ShowLoading()
                },
                dataType:"json",
            	contentType:"application/json",
                success:function (data) {
                if (data.code == 2000){
                            showInfo(index,formSubmit00,data.data);
                        }
                },
                complete:function(){
				     HideLoading();
				},
                error:function () {
                }
            })
}


function showPage(obj,data){
 $("#Pagination").pagination(data,{
             callback:PageCallback,         //pageCallback() 为翻页调用函数
             items_per_page:12,                //每页显示条目数
             num_display_entries: 4,                //连续分页显示分页条目数
             num_edge_entries: 1          //两侧显示的首尾分页的条目数
      });
}
//ajax分页请求,page_index :页码
function PageCallback(page_index,jq){
    page_init(page_index);      //第一页为0
}
//查询
$("body").on("click",".btn_blue",function(){
		if($("#village").val()==''&$("#township").val()==''&$("#county").val()==''){
			bianhao=$("#p_shi").val()
		}
		if($("#village").val()==''&$("#township").val()==''&$("#county").val()!=''){
			bianhao=$("#county").val()
		}
		if($("#village").val()==''&$("#township").val()!=''){
			bianhao=$("#township").val()
		}
		if($("#village").val()!=''){
			bianhao=$("#village").val()
		}
    	var start2 = start.val().replace(/-/g,"");//开始结束时间的截取数字
        var end2 = end.val().replace(/-/g,"");
        if(start2 >= end2){
           end2="";
           end.val("");
        }
        var data_={"page_index": 1,"page_size": 12,'aar040':201808,'disctId':bianhao,'villNumber':$('#cunnumber').val(),
            'helperName':$('#bfname').val(),'type':$('#updateType').val(),
            'field':$('#typeShip').val(),'startTime':start2,'endTime':end2,'attribute':$('#shuxing').val()}
    $.ajax({
        url: url + "data/track/bg/vill",
        data:JSON.stringify(data_),
        method: "post",
        beforeSend:function(request){
              request.setRequestHeader("Authorization",token);
              request.setRequestHeader("X-Requested-With","XMLHttpRequest");
              ShowLoading()
          },
        dataType: "json",
        contentType:"application/json",
        success: function(data){
            if (data.code == 2000){
                showInfo(0,formSubmit00,data.data)
                page.html(Math.ceil(data.data.total/12));
                $("#total").html("总数："+data.data.total);
                showPage($(".searchPage"),data.data.total);
            }else if(data.code == 1009){
				var str=`<tr>
		              <th>序号</th>
		              <th>区县</th>
		              <th>镇街</th>
		              <th>行政村</th>
		              <th>村属性</th>
		              <th>村办公电话</th>
		              <th>操作人</th>

		              <th>修改类别</th>
		              <th>修改字段</th>
		              <th>修改前值</th>
		              <th>修改后值</th>
		              <th>修改时间</th>
		          </tr>
				<tr><td colspan='13' style="font-size:30px;color:#767272;">查无数据</td></tr>`
				$("#formSubmit00").html(str)
				$("#total").empty();
			    $(".allPage").empty();
			}else if(data.code==1005){
				alert(data.message)
			}else if(data.code==4000){
				alert(data.message)
			}
      },
      complete:function(){
		     HideLoading();
		}
  	})
 })

/*导出*/
$("body").on("click","#import",function(){
	if($("#village").val()==''&$("#township").val()==''&$("#county").val()==''){
		bianhao=$("#p_shi").val()
	}
	if($("#village").val()==''&$("#township").val()==''&$("#county").val()!=''){
		bianhao=$("#county").val()
	}
	if($("#village").val()==''&$("#township").val()!=''){
		bianhao=$("#township").val()
	}
	if($("#village").val()!=''){
		bianhao=$("#village").val()
	}
	var start2 = start.val().replace(/-/g,"");//开始结束时间的截取数字
    var end2 = end.val().replace(/-/g,"");
    if(start2 >= end2){
       end2="";
       end.val("");
    }
	$.ajax({
        url: url + "data/track/export/exist/bg/vill",
        data:{},
        beforeSend:function(request){
            request.setRequestHeader("Authorization",token);
            request.setRequestHeader("X-Requested-With","XMLHttpRequest");
        },
        method: "post",
        dataType: "json",
        success: function(data){
        if (data.code == 2000){
    		var data={"page_index": 1,"page_size":totle,'aar040':201808,'disctId':bianhao,'villNumber':$('#cunnumber').val(),
            'helperName':$('#bfname').val(),'type':$('#updateType').val(),
            'field':$('#typeShip').val(),'startTime':start2,'endTime':end2,'attribute':$('#shuxing').val()}
			/*去空*/
            function qukong(obj){
                for(var key in obj){
                    if(obj[key]==null || obj[key]=='' || obj[key]=="null"){
                        console.log(obj[key]);
                        delete obj[key];
                    }
                }
                return obj;
            }
            var newmap=qukong(data);
           // console.log(newmap);
            /*拼接*/
            let strs="";
            function pinjie(obj){
                for(let key in obj){
                    strs+=key+"="+obj[key]+"&";
				}
				return strs;
			}
			let a=pinjie(newmap)
			let b=a.substring(0,a.length-1);
			console.log(b);
			let cc=url+"data/track/export/bg/vill?"+b;
			console.log(cc);
            window.location.href=cc;
      		}
        }
    })

})
</script>
</body>
</html>
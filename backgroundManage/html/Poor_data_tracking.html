<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="renderer" content="webkit">
    <title>贫困户数据足迹</title>
    <link rel="stylesheet" href="../css/pintuer.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../css/pagination.css">
    <!--<link rel="stylesheet" href="../css/inputStyle.css">-->
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/commer.js"></script>
    <script src="../js/jquery.js"></script>
    <script src="../js/jquery.cookie.js"></script>
    <script src="../js/pintuer.js"></script>
    <script src="../js/jquery.cookie.js"></script>
    <script src="../js/inputJavaScript.js"></script>
    <script src="../js/jquery.pagination.js"></script>
    <style>
	.panel>.form-01>#formSubmit00,.panel>#formSubmit00>tbody{
	    width: 100%;
	    font-size: 14px;
	    margin-top: 10px;
	}
	.form-01 table tr th{
	    height: 40px;
	    line-height: 40px;
	    border:solid 1px #ddd;
	   background: #fcfcfc;
	}
	.form-01 #formSubmit00 tr td{
	    height: 34px;
	    line-height: 34px;
	    border:solid 1px #ddd;
	    text-align: center;
	}
	.form-01 #formSubmit00 tr td:nth-child(9),.form-01 #formSubmit00 tr td:nth-child(10){
		color: #00c120;
	}
	.form-01 #formSubmit00 tr td:nth-child(11),.form-01 #formSubmit00 tr td:nth-child(12){
		color: #ff6c00;
	}
	#import{cursor: pointer;}
	/*加载动画*/
        .spinner {
            margin: 5% auto;
            width: 80px;
            height: 80px;
            position: relative;
        }
        .container1 > div, .container2 > div, .container3 > div {
            width: 14px;
            height: 14px;
            background-color: #858585;
            border-radius: 100%;
            position: absolute;
            -webkit-animation: bouncedelay 1.2s infinite ease-in-out;
            animation: bouncedelay 1.2s infinite ease-in-out;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
        }
        .spinner .spinner-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .container2 {
            -webkit-transform: rotateZ(45deg);
            transform: rotateZ(45deg);
        }
        .container3 {
            -webkit-transform: rotateZ(90deg);
            transform: rotateZ(90deg);
        }
        .circle1 { top: 0; left: 0; }
        .circle2 { top: 0; right: 0; }
        .circle3 { right: 0; bottom: 0; }
        .circle4 { left: 0; bottom: 0; }
        .container2 .circle1 {
            -webkit-animation-delay: -1.1s;
            animation-delay: -1.1s;
        }
        .container3 .circle1 {
            -webkit-animation-delay: -1.0s;
            animation-delay: -1.0s;
        }
        .container1 .circle2 {
            -webkit-animation-delay: -0.9s;
            animation-delay: -0.9s;
        }
        .container2 .circle2 {
            -webkit-animation-delay: -0.8s;
            animation-delay: -0.8s;
        }
        .container3 .circle2 {
            -webkit-animation-delay: -0.7s;
            animation-delay: -0.7s;
        }
        .container1 .circle3 {
            -webkit-animation-delay: -0.6s;
            animation-delay: -0.6s;
        }
        .container2 .circle3 {
            -webkit-animation-delay: -0.5s;
            animation-delay: -0.5s;
        }
        .container3 .circle3 {
            -webkit-animation-delay: -0.4s;
            animation-delay: -0.4s;
        }
        .container1 .circle4 {
            -webkit-animation-delay: -0.3s;
            animation-delay: -0.3s;
        }
        .container2 .circle4 {
            -webkit-animation-delay: -0.2s;
            animation-delay: -0.2s;
        }
        .container3 .circle4 {
            -webkit-animation-delay: -0.1s;
            animation-delay: -0.1s;
        }
        @-webkit-keyframes bouncedelay {
            0%, 80%, 100% { -webkit-transform: scale(0.0) }
            40% { -webkit-transform: scale(1.0) }
        }
        @keyframes bouncedelay {
            0%, 80%, 100% {
                transform: scale(0.0);
                -webkit-transform: scale(0.0);
            } 40% {
                  transform: scale(1.0);
                  -webkit-transform: scale(1.0);
              }
        }
        .btn_blue {
		    color: #fff;
		    background: #428bca;
		    border: 1px solid #2698FB;
		    width: 70px;
		    text-align: center;
		    margin: 10px;
		    border-radius: 3px;
		}
		.form-01 dt{
        	height: 30px;
		    line-height: 30px;
		    float: left;
		    margin-right: 10px;
		    border-radius: 12px;
		    text-align: center;
		    padding: 2px 6px;
		    cursor: pointer;
		    position: relative;
		    color: #555;
		}
		.active{background: #70c1ff!important;color: #fff!important;border-radius: 12px;}
	</style>
</head>
<body>
<div class="panel admin-panel">
  <div class="panel-head"><strong><span class="icon-pencil-square-o"></span>贫困户数据足迹</strong>
      <a href="javascript:history.back(-1)" class="data_tracking button border-main">返回</a>
      <span id="import" class="data_tracking button border-main">导出</span>
  </div>
  	<div class="form-01">
      <div class="search">
          <label for="">行政区划</label>
          <!--<input type="text" value="西安市" disabled>-->
          <select name="" id="p_shi">
          </select>
          <select name="" id="county">
          	<option value="">县（区）</option>
          </select>
          <select name="" id="township">
          </select>
          <select name="" id="village">
          </select>
          <!--<select name="" id="year">
          		<option value="">年度</option>
                <option value="201808">2018年</option>
                <option value="201712">2017年</option>
          </select>-->
        <div>
        	<lable style='width:105px;margin-right: 12px;display: inline-block;'>信息变更人员姓名</lable><input type="text" id="cyname" />
        	<lable style='width:140px;margin-right: 12px;display: inline-block;'>信息变更人员证件号码</lable><input type="text" id="id_number" />
        </div>
        <div>
        	<lable style='width:105px;margin-right: 12px;display: inline-block;'>帮扶责任人姓名</lable><input type="text" id="bfname" />
        	<lable style='width:140px;margin-right: 12px;display: inline-block;'>帮扶责任人联系电话</lable><input type="text" id="phone_number" />
        </div>
        <div style="overflow: hidden;">
      		  <label for="">修改类别</label>
              <select name="" id="updateType">
                  <option value="">请选择</option>
                  	  <option value="1">基本信息</option>
                      <option value="2">生产生活</option>
                      <option value="3">收入信息</option>
                      <option value="4">家庭成员</option>
              </select>
              <label for="">修改指标</label>
              <select name="" id="typeShip">
              	<option value="">--请选择--</option>
              </select>
              <lable>修改时间</lable>
              <input type="date" id="start" style="width: 130px;"/> -- <input type="date" id="end" style="width: 130px;"/>
        </div>
        <div class="shuxing" style="clear: both;">
			<dl id="p_shuxing">
				<dt style="margin-right: 50px;padding-left:0">贫困户属性</dt>
				<dt sleep="" class="active">全部</dt>
				<dt sleep="01">一般贫困户</dt>
				<dt sleep="04">低保贫困户</dt>
				<dt sleep="06">五保贫困户</dt>
				<dt sleep="05">一般农户</dt>
				<dt sleep="02">低保户</dt>
				<dt sleep="03">五保户</dt>
			</dl>
		</div>
        <div class="tuopin" style="clear: both;margin-top:50px;">
          	<dl id="p_status">
          		<dt style="margin-right: 60px;padding-left:0">脱贫状态</dt>
          		<dt sleep="" class="active">全部</dt>
          		<dt sleep="1">已脱贫（享受政策）</dt>
          		<dt sleep="4">已脱贫（不享受政策）</dt>
          		<dt sleep="0">未脱贫</dt>
          		<dt sleep="3">返贫</dt>
          		<!--<dt sleep="2">预脱贫</dt>-->
          	</dl>
     	 </div>
      </div>
        <input type="button" class="btn_blue" style="float: right;" name="" value="查询">
        <div class="spinner" style="display: block;z-index: 999">
	          <div class="spinner-container container1">
	              <div class="circle1"></div>
	              <div class="circle2"></div>
	              <div class="circle3"></div>
	              <div class="circle4"></div>
	          </div>
	          <div class="spinner-container container2">
	              <div class="circle1"></div>
	              <div class="circle2"></div>
	              <div class="circle3"></div>
	              <div class="circle4"></div>
	          </div>
	          <div class="spinner-container container3">
	              <div class="circle1"></div>
	              <div class="circle2"></div>
	              <div class="circle3"></div>
	              <div class="circle4"></div>
	          </div>
	    </div>
	    <div style="width:1100px;overflow-x: scroll;">
	    	<table id="formSubmit00" class="form-x" style="width: 1250px;">
			</table>
	    </div>

      <div class="pages">
	          <div class="paging">
	              <div id="Pagination"></div>
	              <div class="searchPage">
	                  <span class="page-sum">共<strong class="allPage"></strong>页</span>
	                  <span id="total">总数：</span>
	          </div>
	      </div>
	  </div>
	</div>
</div>
<script>
var city = $("#county");
var area = $("#township");
var town =$("#village");
var start=$('#start');
var end=$('#end');
var bianhao;
var totle;
var str = `<option value="">县（区）</option>`;
city.html(str);
var str1 = `<option value="">乡（镇）</option>`;
area.html(str1);
var str2 = `<option value="">村</option>`;
town.html(str2);
let token=$.cookie("token");
let tokenCon=$.cookie("loginMessage");
let aa=JSON.parse(tokenCon);

$(".tuopin dl >dt:nth-child(2)").nextAll().click(function(){
	$(".tuopin dl >dt:nth-child(2)").removeClass("active");
	$(this).toggleClass("active");
});
$(".tuopin dl >dt:nth-child(2)").click(function(){
	$(this).siblings().removeClass('active');
})
$(".shuxing dl >dt:nth-child(2)").nextAll().click(function(){
    $(".shuxing dl >dt:nth-child(2)").removeClass("active");
    $(this).toggleClass("active");
    //$(this).toggleClass("active").siblings().removeClass("active");
    //给点击对象添加类
});
$(".shuxing dl >dt:nth-child(2)").click(function(){
    $(this).siblings().removeClass('active');
})
//行政区划渲染
//加载西安市
init_Shi();
    function init_Shi(){
        var p_shi=$("#p_shi");
        $.ajax({
            url: url + "district/city",
            data:{},
            beforeSend:function(request){
                request.setRequestHeader("Authorization",token);
                request.setRequestHeader("X-Requested-With","XMLHttpRequest");
            },
            method: "get",
            dataType: "json",
            json: "callback",
            jsonpCallback: 'jsonpCallback',
            success: function(data){
                if (data.code == 2000){
                    showShiInfo(p_shi,data);
                    init_County()
                }
            }
        })
    }
    function showShiInfo(obj,data){
        obj.empty();
        var str = `<option value="">全部</option>`;
        var string = "";
        let arr=[];
        for(let i = 0; i < data.data.length; i++){
            str += `
         <option value="${data.data[i].AAR001}">${data.data[i].AAR009}</option>
     `;
            let obj={"number":data.data[i].AAR001,"name":data.data[i].AAR009};
            arr.push(obj);
        }
        obj.html(str);
        let tokenCon=$.cookie("loginMessage");
        let aa=JSON.parse(tokenCon);
        if(aa.aar008==619900000000){
        	$("#p_shi").empty().append("<option value='619900000000'>西咸新区</option>").attr("disabled","disabled");
        }
    }
	$("#p_shi").change(function(){
	    var opt=$("#p_shi");
	    var opt1 = $("#county");
	         $.ajax({
	            url: url + "district/county",
	            data:{"aar001":opt.val()},
	            beforeSend:function(request){
			          request.setRequestHeader("Authorization",token);
			          request.setRequestHeader("X-Requested-With","XMLHttpRequest");
		        },
	            method: "get",
	            dataType: "json",
	            json: "callback",
	            jsonpCallback: 'jsonpCallback',
	            success: function(data){
	                if (data.code == 2000){
	                     init_County();
	                }
	            }
	    })
	});
function init_County(){
	var opt=$("#p_shi");
	var opt1 = $("#county");
    $.ajax({
	    url: url + "district/county",
	    data:{"aar001":opt.val()},
	    beforeSend:function(request){
              request.setRequestHeader("Authorization",token);
              request.setRequestHeader("X-Requested-With","XMLHttpRequest");
        },
	    method: "get",
	    dataType: "json",
	    json: "callback",
	    jsonpCallback: 'jsonpCallback',
	    success: function(data){
	        if (data.code == 2000){
	            showCountyInfo( city,data);
	        }
	    }
    })
}
function showCountyInfo(obj,data){
     obj.empty();
     var str = `<option value="">县（区）</option>`;
     var string = "";
     let arr=[];
     var opt = $("#township");
     var opt1 = $("#village");
     var str1 = `<option value="">乡（镇）</option>`;
     var str2 = `<option value="">村</option>`
     opt1.html(str2);
     opt.html(str1);
     for(let i = 0; i < data.data.length; i++){
         str += `
         <option value="${data.data[i].AAR001}">${data.data[i].AAR009}</option>
     `;
         let obj={"number":data.data[i].AAR001,"name":data.data[i].AAR009};
         arr.push(obj);
     }
     obj.html(str);
    let tokenCon=$.cookie("loginMessage");
    let aa=JSON.parse(tokenCon);
    for(let i=0;i<arr.length;i++){
        //console.log(arr[i].number+"---"+aa.aaa113);
        if(arr[i].number==aa.aar008 ||arr[i].number==aa.aaa113){
            $("#county").empty().append("<option value='"+arr[i].number+"'>"+arr[i].name+"</option>").attr("disabled","disabled");
            $("#p_shi").attr("disabled","disabled");
            var opt=$("#county");
            var opt1 = $("#township");
            $.ajax({
                url: url + "district/town",
                data:{"county":opt.val()},
                beforeSend:function(request){
                    request.setRequestHeader("Authorization",token);
                    request.setRequestHeader("X-Requested-With","XMLHttpRequest");
                },
                method: "get",
                dataType: "json",
                json: "callback",
                jsonpCallback: 'jsonpCallback',
                success: function(data){
                    if (data.code == 2000){
                        showTownInfo(opt1,data);
                        page.html(data.data.total);
                    }
                }
            })
        }
    }
}

$("#county").change(function(){
    var opt=$("#county");
    var opt1 = $("#township");
         $.ajax({
            url: url + "district/town",
            data:{"county":opt.val()},
            beforeSend:function(request){
                  request.setRequestHeader("Authorization",token);
                  request.setRequestHeader("X-Requested-With","XMLHttpRequest");
            },
            method: "get",
            dataType: "json",
            json: "callback",
            jsonpCallback: 'jsonpCallback',
            success: function(data){
                if (data.code == 2000){
                    showTownInfo(opt1,data);
                     page.html(data.data.total);
                }
            }
    })
});

function showTownInfo(obj,data){
     obj.empty();
     let arr=[];
     var str = `<option value="">乡（镇）</option>`;
     for(let i = 0; i < data.data.length; i++){
         str += `
         <option value="${data.data[i].AAR001}">${data.data[i].AAR009}</option>
     `;
      obj.html(str);
         let obj2={"number":data.data[i].AAR001,"name":data.data[i].AAR009};
         arr.push(obj2);
     }
    let tokenCon=$.cookie("loginMessage");
    let aa=JSON.parse(tokenCon);
    if(aa.aar008.substring(6)!="000000"){
        for(let i=0;i<arr.length;i++){
            if(arr[i].number==aa.aar008){
                $("#township").empty().append("<option value='"+aa.aar008+"'>"+aa.userCode+"</option>").attr("disabled","disabled");
                var opt=$("#township");
                var opt1 = $("#village");
                $.ajax({
                    url: url + "district/village",
                    data:{"town":opt.val()},
                    beforeSend:function(request){
                        request.setRequestHeader("Authorization",token);
                        request.setRequestHeader("X-Requested-With","XMLHttpRequest");
                    },
                    method: "get",
                    dataType: "json",
                    json: "callback",
                    jsonpCallback: 'jsonpCallback',
                    success: function(data){
                        if (data.code == 2000){
                            var town = $("#township").val();
                            var vill = $("#village");
                            $.ajax({
                                url: url + "district/village",
                                data:{"town": town},
                                method: "get",
                                dataType: "json",
                                beforeSend:function(request){
                                    request.setRequestHeader("Authorization",token);
                                    request.setRequestHeader("X-Requested-With","XMLHttpRequest");
                                },
                                success: function(data){
                                    if (data.code == 2000){
                                        showVillageInfo(vill,data);
                                    }
                                }
                            })
                            showVillageInfo(opt1,data);
                            page.html(data.data.total);
                        }
                    }
                })
            }
        }
    }
}

$("#township").change(function(){
    var town = $("#township").val();
    var vill = $("#village");
         $.ajax({
            url: url + "district/village",
            data:{"town": town},
            method: "get",
            dataType: "json",
            beforeSend:function(request){
                  request.setRequestHeader("Authorization",token);
                  request.setRequestHeader("X-Requested-With","XMLHttpRequest");
            },
            success: function(data){
                if (data.code == 2000){
                    showVillageInfo(vill,data);
                }
            }
    })
});
function showVillageInfo(obj,data){
       obj.empty();
     var str = `<option value="">村</option>`;
     for(let i = 0; i < data.data.length; i++){
         str += `
         <option value="${data.data[i].AAR001}">${data.data[i].AAR009}</option>
     `;
      obj.html(str);
     }
}

let updateType=$("#updateType");
let typeShip=$("#typeShip");
updateType.change(function(){
    tiantype();
})
/*修改类别函数*/
function tiantype(){
    var type=$("#updateType").val();
    $.ajax({
        url: url+"info/poverty/field",
        beforeSend:function(request){
            request.setRequestHeader("Authorization",token);
            request.setRequestHeader("X-Requested-With","XMLHttpRequest");
        },
        data:{"type":type},
        async:false,
        method:"post",
        type:"json",
        success:function(data){
            if(data.code === 2000){
                showType(typeShip,data.data);
            }
        }
    })
}
function showType(obj,data){
    obj.empty();
    let str=`<option value="">--请选择--</option>`;
    for(let i in data){
        str+=`
         <option value="${data[i]}">${i}</option>
        `;
    }
    obj.html(function(i,value){
        return value+str;
    })
}
//页面初始渲染
function ShowLoading() {
    $(".spinner").show();
}
function HideLoading() {
    $(".spinner").hide();
}
 	var page = $(".allPage");
    var formSubmit00 = $("#formSubmit00");
    let indexs=1;
    $(document).ready(function(){
        $("#Pagination").pagination("15");
    })
    let zhanghao=aa.aar008;
	console.log(zhanghao);
	var data_={"page_size":12,"page_index":1,'aar040':201808,'disctId':zhanghao};
    $.ajax({
        url:url+"data/track/holder",
        //data:{"page_size":12,"page_index":1,'aar040':201808,'disctId':zhanghao},
        data:JSON.stringify(data_),
        method:"post",
        beforeSend:function(request){
            request.setRequestHeader("Authorization",token);
            request.setRequestHeader("X-Requested-With","XMLHttpRequest");
            ShowLoading();
        },
        dataType:"json",
        contentType:"application/json",
        success:function(data){
        	if($("#village").val()==''&$("#township").val()==''&$("#county").val()==''){
				bianhao=$("#p_shi").val()
			}
			if($("#village").val()==''&$("#township").val()==''&$("#county").val()!=''){
				bianhao=$("#county").val()
			}
			if($("#village").val()==''&$("#township").val()!=''){
				bianhao=$("#township").val()
			}
			if($("#village").val()!=''){
				bianhao=$("#village").val()
			}
            if(data.code===2000){
                showInfo(0,formSubmit00,data.data)
                page.html(Math.ceil(data.data.total/12));
                $("#total").html("总数："+data.data.total);
                totle=data.data.total;
                showPage($(".searchPage"),data.data.total);
            }else if(data.code==1005){
                alert(data.message)
            }else if(data.code==1009){
                alert(data.message)
            }else if(data.code==4000){
                alert(data.message)
            }
        },
        complete:function(){
		     HideLoading();
		}
    })

function showInfo(index,obj,data){
   obj.empty();
   var  str=`
       <tr>
          <th>序号</th>
          <th>区县</th>
          <th>镇街</th>
          <th>行政村</th>
          <th>户主姓名</th>
          <th>户主身份证号</th>
          <th>帮扶责任人姓名</th>
          <th>帮扶责任人联系电话</th>
          <th>修改类别</th>
          <th>修改字段</th>
          <th>修改前值</th>
          <th>修改后值</th>
          <th>修改时间</th>
       </tr>
    `;
    for(let i = 0; i < data.list.length; i++){
      str+=` <tr>
              <td>${index*12+i+1}</td>
              <td>${data.list[i].AAR009_X}</td>
              <td>${data.list[i].AAR009_Z}</td>
              <td>${data.list[i].AAR009_C}</td>
              <td>${data.list[i].AAC029}</td>
              <td>${data.list[i].AAC031}</td>
              <td>${data.list[i].AAB002}</td>
              <td>${data.list[i].AAR012}</td>
              <td>${data.list[i].MODIFY_TYPE}</td>
              <td>${data.list[i].INFO_NAME}</td>
              <td>${data.list[i].UPDATE_BEFORE}</td>
              <td>${data.list[i].UPDATE_AFTER}</td>
              <td>${data.list[i].DISTRICT_TIME}</td>
          </tr>`;
    }
    obj.html(str);
}
//分页
    function page_init(index) {
    	var p_status=[];
		var p_shuxing=[];
    	if($("#village").val()==''&$("#township").val()==''&$("#county").val()==''){
			bianhao=$("#p_shi").val()
		}
		if($("#village").val()==''&$("#township").val()==''&$("#county").val()!=''){
			bianhao=$("#county").val()
		}
		if($("#village").val()==''&$("#township").val()!=''){
			bianhao=$("#township").val()
		}
		if($("#village").val()!=''){
			bianhao=$("#village").val()
		}
    	var start2 = start.val().replace(/-/g,"");//开始结束时间的截取数字
        var end2 = end.val().replace(/-/g,"");
        if(start2 >= end2){
           end2="";
           end.val("");
        }
        let propertys=$(".shuxing dl dt.active");
	    let statuss=$(".tuopin dl dt.active");
	    getValue(propertys,p_shuxing);
	    getValue(statuss,p_status);
	    function getValue(obj,arr){
	        // let arr=[];
	        for(let i=0;i<obj.length;i++){
	            arr.push(obj.eq(i).attr("sleep"));
	        }
	        return arr;
	    }
     	indexs=index+1;
     	var data_={"page_index": index+1,"page_size": 12,'aar040':201808,'disctId':bianhao,
            'personName':$('#cyname').val(),'personCard':$('#id_number').val(),'helperName':$('#bfname').val(),
            'helperNumber':$('#phone_number').val(),'type':$('#updateType').val(),'field':$('#typeShip').val(),
            'startTime':start2,'endTime':end2,'status':p_status,'attribute':p_shuxing}
        $.ajax({
            url:url + "data/track/holder",
            type:"post",
            data:JSON.stringify(data_),
            beforeSend:function(request){
                request.setRequestHeader("Authorization",token);
                request.setRequestHeader("X-Requested-With","XMLHttpRequest");
                ShowLoading();
            },
            dataType:"json",
            contentType:"application/json",
            success:function (data) {
            if (data.code == 2000){
                    showInfo(index,formSubmit00,data.data)
                }
            },
            complete:function(){
			     HideLoading();
			},
            error:function () {
            }
        })
	}

function showPage(obj,data){
 $("#Pagination").pagination(data,{
         callback:PageCallback,         //pageCallback() 为翻页调用函数
         items_per_page:12,                //每页显示条目数
         num_display_entries: 4,                //连续分页显示分页条目数
         num_edge_entries: 1          //两侧显示的首尾分页的条目数
   });
}

//ajax分页请求,page_index :页码
function PageCallback(page_index,jq){
    page_init(page_index);      //第一页为0
}
//查询

$("body").on("click",".btn_blue",function(){
	var p_status=[];
	var p_shuxing=[];
	if($("#village").val()==''&$("#township").val()==''&$("#county").val()==''){
		bianhao=$("#p_shi").val()
	}
	if($("#village").val()==''&$("#township").val()==''&$("#county").val()!=''){
		bianhao=$("#county").val()
	}
	if($("#village").val()==''&$("#township").val()!=''){
		bianhao=$("#township").val()
	}
	if($("#village").val()!=''){
		bianhao=$("#village").val()
	}
	let propertys=$(".shuxing dl dt.active");
    let statuss=$(".tuopin dl dt.active");
    getValue(propertys,p_shuxing);
    getValue(statuss,p_status);
    function getValue(obj,arr){
        // let arr=[];
        for(let i=0;i<obj.length;i++){
            arr.push(obj.eq(i).attr("sleep"));
        }
        return arr;
    }
    console.log(p_status)
    var start2 = start.val().replace(/-/g,"");//开始结束时间的截取数字
    var end2 = end.val().replace(/-/g,"");
    if(start2 >= end2){
       end2="";
       end.val("");
    }
    var data_={"page_index":1,"page_size": 12,'aar040':201808,'disctId':bianhao,
            'personName':$('#cyname').val(),'personCard':$('#id_number').val(),'helperName':$('#bfname').val(),
            'helperNumber':$('#phone_number').val(),'type':$('#updateType').val(),'field':$('#typeShip').val(),
            'startTime':start2,'endTime':end2,'status':p_status,'attribute':p_shuxing}
    $.ajax({
        url: url + "data/track/holder",
        data:JSON.stringify(data_),
        method: "post",
        beforeSend:function(request){
              request.setRequestHeader("Authorization",token);
              request.setRequestHeader("X-Requested-With","XMLHttpRequest");
              ShowLoading();
          },
        dataType: "json",
        contentType:"application/json",
        success: function(data){
            if (data.code == 2000){
                showInfo(0,formSubmit00,data.data)
                page.html(Math.ceil(data.data.total/12));
                $("#total").html("总数："+data.data.total);
                showPage($(".searchPage"),data.data.total);
            }else if(data.code == 1009){
				var str=`<tr>
		              <th>序号</th>
		              <th>区县</th>
		              <th>镇街</th>
		              <th>行政村</th>
		              <th>户主姓名</th>
		              <th>户主身份证号</th>
		              <th>帮扶责任人姓名</th>
		              <th>帮扶责任人联系电话</th>
		              <th>修改类别</th>
		              <th>修改字段</th>
		              <th>修改前值</th>
		              <th>修改后值</th>
		              <th>修改时间</th>
		        </tr>
				<tr><td colspan='13' style="font-size:30px;color:#767272;">查无数据</td></tr>`
				$("#formSubmit00").html(str)
				$("#total").empty();
			    $(".allPage").empty();
			}else if(data.code==1005){
				alert(data.message)
			}else if(data.code==4000){
				alert(data.message)
			}
      },
      complete:function(){
	     HideLoading();
	  }
  	})
})

/*导出*/
$("body").on("click","#import",function(){
	var p_status=[];
	var p_shuxing=[];
	if($("#village").val()==''&$("#township").val()==''&$("#county").val()==''){
		bianhao=$("#p_shi").val()
	}
	if($("#village").val()==''&$("#township").val()==''&$("#county").val()!=''){
		bianhao=$("#county").val()
	}
	if($("#village").val()==''&$("#township").val()!=''){
		bianhao=$("#township").val()
	}
	if($("#village").val()!=''){
		bianhao=$("#village").val()
	}
	var start2 = start.val().replace(/-/g,"");//开始结束时间的截取数字
    var end2 = end.val().replace(/-/g,"");
    if(start2 >= end2){
       end2="";
       end.val("");
    }
    let propertys=$(".shuxing dl dt.active");
    let statuss=$(".tuopin dl dt.active");
    getValue(propertys,p_shuxing);
    getValue(statuss,p_status);
    function getValue(obj,arr){
        // let arr=[];
        for(let i=0;i<obj.length;i++){
            arr.push(obj.eq(i).attr("sleep"));
        }
        return arr;
    }
    console.log(p_status)
    var data1 = {"page_index":1,"page_size": totle,'aar040':201808,'disctId':bianhao,
            'personName':$('#cyname').val(),'personCard':$('#id_number').val(),'helperName':$('#bfname').val(),
            'helperNumber':$('#phone_number').val(),'type':$('#updateType').val(),'field':$('#typeShip').val(),
            'startTime':start2,'endTime':end2,'status':p_status,'attribute':p_shuxing};
	$.ajax({
        url: url + "data/track/export/exist/holder",
        data:JSON.stringify(data1),
        beforeSend:function(request){
            request.setRequestHeader("Authorization",token);
            request.setRequestHeader("X-Requested-With","XMLHttpRequest");
        },
        method: "post",
        dataType: "json",
        contentType:"application/json",
        success: function(data){
        if (data.code == 2000){
    		var data = {};
			/*去空*/
            function qukong(obj){
                for(var key in obj){
                    if(obj[key]==null || obj[key]=='' || obj[key]=="null"){
                        console.log(obj[key]);
                        delete obj[key];
                    }
                }
                return obj;
            }
            var newmap=qukong(data);
            console.log(newmap);
            /*拼接*/
            let strs="";
            function pinjie(obj){
                for(let key in obj){
                    strs+=key+"="+obj[key]+"&";
				}
				return strs;
			}
			let a=pinjie(newmap)
			let b=a.substring(0,a.length-1);
			console.log(b);
			let cc=url+"data/track/export/holder?"+b;
			console.log(cc);
            window.location.href=cc;
      		}
        }
    })
})
</script>
</body>
</html>